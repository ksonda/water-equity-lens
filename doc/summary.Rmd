---
title: "Tract-level Pillar Indicator Summary"
author: 
  - Kyle Onda^[kyle.onda@gmail.com]
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 5
    code_folding: hide
    fig_width: 8
    fig_height: 8
    theme: readable
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(tidyverse)
library(mapview)
library(RColorBrewer)
library(viridisLite)
library(leafsync)

p <- read_sf("../out/Tracts_Pillars_All.geojson")
t <- read_sf("../data/tracts_wide.geojson")
load("../cache/indicators_ungraded.RData")
```

## Affordability and demographics

Below we show four synced graphs. In the upper left, layers about the affordability metric can be toggled on and off. Note P1_Grade_affordability_alt for an affordability grade assuming lower thresholds for income. The upper right hsows selected demographic layers. The bottom left shows cuttoff and delinquency rates and particpation in CAP and incentive programs. The bottom right shows complaint rates, redressal rates, community meetings, and staff share living in each tract. Combinations of these variables could be used to show stores about for example:

* High water affordability being correlated with high delinquency rates, but less so with cutoff rates

* Cutoff rates being more associated with different racial groups

* CAP participation being correlated with higher home ownership rates.

* Pariticpation in efficiency programs being inversely related to CAP participation.

* The presence of community meetings being inversely related with complaints
```{r, results="asis"}

d <- select(P1, white_perc, hh_income_upper_limit_Q1E, PPI, own_rate, bachAbove)
# MEDIAN AND LOWER INCOME QUINTILE

p1.1 <- select(p,P1_HBI, P1_PPI, P1_Grade_Affordability, P1_Grade_Affordability_alt)

p1.2 <- select(p, P1_Grade_Delinquency,P1_Grade_Cutoff, P1_Grade_CAP, P1_Grade_Efficiency)

p1.3 <- select(p, P1_Grade_Complaints_per1000conn, P1_Grade_Complaint_Resolution, P2_Grade_Staff_Share, P3_Grade_Meetings)


m1 <- mapview(p1.1,burst=TRUE)
m1.2 <- mapview(p1.2,burst=TRUE)
m1.3 <- mapview(p1.3, burst=TRUE)
md <- mapview(d,burst=TRUE)

sync(m1,md,m1.2,m1.3)

#% Black

#% with bachelors

#%renter



```

## Resilience, Asset Conditions, and Management

Below, we show 3 charts. The top left corresponds to utlity infrastrucutre conditions (Lead line prevalence, Pipe breaks/leaks, and Sewer Overflows). The top right to asset management activity (lead line replacement, pipe replacement, and pipe maintenance). The bottom left shows demographics. Together, these 3 map groups could be used to visualize the extent to which areas of poor performance may correspond to gaps in maintenance activity, or whether they are matched. Also, the extent to which vulnerable populations may be disproportionately impacted by poor infrastructure performance
```{r cars}
p3.1 <- select(p,P3_Grade_Lead,P3_Grade_Breaks,P3_Grade_SSO)
p3.2 <- select(p,P3_Grade_Lead_Replace,P3_Grade_Network_Renewal,P3_Grade_Maintenance)

m3.1   <- mapview(p3.1,burst=TRUE)
m3.2 <- mapview(p3.2, burst=TRUE)

sync(m3.1,m3.2,md)
```

## All indicators

For reference, all raw performance indicators are shown in the map below.

```{r results="asis"}
mapview(p,burst=TRUE)
```